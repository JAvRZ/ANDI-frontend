<section ng-controller="PanelController as panel">
    <ul class="nav nav-tabs">
        <li ng-class="{active:panel.tab===1}" class="active"> <a href ng-click="panel.selectTab(1)" data-toggle="tab">Test Selection</a></li>

        <li ng-class="{active:panel.tab===2}"><a href ng-click="panel.selectTab(2)" data-toggle="tab" >Demographics and Data Entry</a></li>
        
        <li ng-class="{active:panel.tab===3}"><a href ng-click="panel.selectTab(3)" data-toggle="tab">Results</a></li>

      <div  ng-controller="treeController as treeCtrl">
        <div class="panel" ng-show="panel.isSelected(1)">
            <div class="tab-pane fade in active" id="tab1">
            <br> <br>
              <div class="col-sm-7">
                 <div class="alert alert-info">
Welcome to the ANDI portal. On this page you can select the neuropsychological tests you have administered and which you want to analyze. You can browse the tests by category, or search for the tests by using the ‘search for…’ function. Clicking the ‘+’ icon will expand each section. Ticking the boxes will add the tests to the ‘Selected tests’ list, and from here you can arrange the order of your variables.
Your data will automatically be compared to the latest version of ANDI. In case you wish to select an older version you can click ‘older version’. Note that we highly recommend always using the latest version.
When you have completed the test selection, press Next to go to the next step.
                </div>

                <h3>Normative data</h3>
              
                <select ng-model="folders.value" 
                        ng-options="v for v in folders.values"
                        ng-change="treeCtrl.getTreeData(folders.value)"
                        class ="form-control" required>
                </select>
                 <!-- <select ng-model="foldername" class ="form-control"  ng-change="treeCtrl.getTreeData(foldername)" required>
                  <option ng-repeat="x in folders" value="{{x}}"> {{x}} </option>
                </select> -->

                <h3>Search for relevant tests</h3>
                <input type="text" ng-model="testSearch" class = "form-control" 
                ng-keyup="treeCtrl.treeExpanded()" placeholder ="Search for ..."/>
                 <div
                  ivh-treeview-id-attribute="'uuid'"
                  ivh-treeview="treeCtrl.tests"
                  ivh-treeview-expand-to-depth="0"
                  ivh-treeview-default-selected-state="false"
                  ivh-treeview-filter="testSearch"
                  ivh-treeview-validate="true"
                  ivh-treeview-selected-attribute="'isSelected'"
                  ivh-treeview-on-cb-change="fancy.otherAwesomeCallback(ivhNode, ivhIsSelected, ivhTree)"
                  >
                </div>
              </div>
              <div class ="col-sm-5">
                <h3>Selected Tests</h3>
                <script type="text/ng-template"  id="tree_item_renderer">
                  <span ng-if="data.children.length===0"  ng-click="nodeClicked(data)"  >
                    <!-- /*<i class="glyphicon-plus"></i> */-->
                    {{treeCtrl.getSelectedNodes(data)}}
                  </span>
                  <div ng-if="data.children" class="some">    
                      <div ng-if="treeCtrl.getSelectedNodes(data)"  ng-repeat="data in data.children" class="parent_li"  ng-include="'tree_item_renderer'" tree-node>
                      </div>
                  </div>
                </script>
                <div class="tree" style="max-height:330px; overflow-y:auto;">
                    <div ng-if="treeCtrl.getSelectedNodes(data)" ng-repeat="data in treeCtrl.tests"  ng-include="'tree_item_renderer'"></div>
                </div>
                <hr>
              </div>
            </div>
            <div class="col-sm-12">
              <button type="button" class ="btn btn-next" ng-click="panel.next()"> Next</button> 
            </div>
        </div>

        <div class="panel col-sm-12 col-xs-12 col-lg-12" ng-show="panel.isSelected(2)" class="tab-pane fade in active">
            <form name="patient.form" ng-model="fields" ng-submit="treeCtrl.submit()" novalidate angular-validator>  

              <div class="col-sm-12" >
                 <div class="alert alert-info">
                    On this screen you can add the test values and demographic information for your patients. You can either fill out the table below, or select "I wish to upload data". If you wish to upload your data you can download the .csv template in which the test scores can be filled out.    After you have saved the file you can upload it to the page by clicking "choose file". Once the file has been uploaded the screen will ask you to define your missing values. When you submit this page, the website will fill out the table with your information and you can check whether it has done so correctly. Note that all patients need to have a unique ID. At the bottom of the page under "Advanced settings" you can change statistical settings.
                </div>


                <div>
                  <div style="width:auto;overflow:auto;">
                    <table class="">

                    <tr>
                      <td valign="top" ng-repeat="data in treeCtrl.tabledata" class="tableindex{{treeCtrl.counterlimit}}">
                        <table  ng-attr-export-csv="{{ treeCtrl.counterlimit===0 ? 'csv' : '' }}" separator=";"  border="0">
                          <tr>
                            <td colspan="2" >
                                <tree-grid tree-obj="patient" 
                                tree-disable="isDisabled"
                                 tree-table="treeCtrl" tree-index="treeCtrl.counterlimit" tree-data="treeCtrl.tests" tree-control="treeCtrl.my_tree" col-defs="treeCtrl.col_defs" expand-on="treeCtrl.expanding_property" on-select="treeCtrl.my_tree_handler(branch)" expand-level="2" icon-leaf= "glyphicon"></tree-grid>
                            </td>
                          </tr>
                        </table>
                      </td>
                    </tr>
                  </table>
                     
                </div>
                 <button type="button"  ng-hide="btnAddPatient" class ="btn" ng-click="treeCtrl.addPatient()"> Add Patient</button>
                </div>
                <hr>
                <a class="btn" title="Export Table" ng-click="csv.generate()" ng-href="{{ csv.link() }}" download="PatientTable.csv">
                <i class="glyphicon glyphicon-download-alt"></i> Download Template
                </a>
                <div class="alert alert-info">
                  <strong>NOTE!</strong>To upload a batch of patient scores please download this template. Please make sure each patient has their own column.
                </div>

                  <div  class="fileinput fileinput-new" data-provides="fileinput">
                    <span class="btn btn-default btn-file">
                    <input type="file" name="..." id="fileContent" ></span>
                    <span class="fileinput-filename"></span>
                    <a class="btn" title="Upload to Table" ng-click="treeCtrl.uploadCsv()">
                      <i class="glyphicon glyphicon-upload"></i> Upload data
                    </a>
                  </div>


                  <br><br>
                  <h3>Advanced Settings</h3>
                  <hr>
                    <label>One tailed or two tailed </label>
                    <select ng-init="patient.sig='twoTailed'" name="sig" ng-model="patient.sig"  class ="form-control"  required>
                      <option value="twoTailed">Two Tailed</option>
                      <option value="oneTailedRight">One Tailed Right</option> 
                      <option value="oneTailedLeft">One Tailed Left</option>
                    </select>
                    <span class="has-error" ng-show="treeCtrl.submited && patient.form.sig.$error.required">Required</span>
                    <br><br>
                    <label>Confidence Interval</label>
                    <select ng-init="patient.conf='95'" name="conf" ng-model="patient.conf"  class ="form-control" required>
                      <option value="95">95</option>                      
                      <option value="90">90</option>                      
                      <option value="99">99</option>
                      <option value="99">68</option>
                    </select>

                    <input type="hidden"  name="nomative" ng-model="patient.nomative" value="" />
                    <span class="has-error" ng-show="treeCtrl.submited && patient.form.conf.$error.required">Required</span>
                  <hr>


                  <button type="submit" class="btn btn-submit"  id="submit">Submit</button>
                  <button type="button" class="btn btn-previous" ng-click="panel.previous()"> Previous</button>
                 <!--  <button type="button" class ="btn btn-next" ng-click="panel.next()"> Next</button>  -->
             </div>
            </form>
        </div>

        <div class="panel" ng-show="panel.isSelected(3)">
          <div ng-controller="plotController as plotCtrl" class="col-sm-12">
          <h2>Results Plots</h2>
            <select ng-init="patient.chart='line'" ng-model="patient.chart" class ="form-control" required ng-change="plotCtrl.FormChart(patient.chart)">
             <option value="line"> Line Chart </option>
             <option value="scatter"> Scatter plot </option>
             <option value="radar"> Radar Chart </option>
            </select>
            <div id="lines-graph" class="lines-graph"></div>
            <!-- <nvd3 options="plotCtrl.options" data="plotCtrl.data"></nvd3> -->
          </div>
        </div>  
      </div>
    </ul>
</section>